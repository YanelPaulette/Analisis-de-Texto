---
title: "Analizando texto  con Text Mining"
subtitle: " Letra *El B贸mbon*. Los Palmeras"
output:
  html_document:
    df_print: paged
  xaringan::moon_reader:
    seal: no
    css:
    - default
    - shinobi
    - tamu-fonts
    nature:
      ratio: '16:9'
      highlightStyle: github
      highlightLines: yes
    language: spanish
---




```````{r include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE)

```

-------------------------

El presente an谩lisis se realiz贸 gracias a la capacitaci贸n  en el [Club de R para RRHH](https://r4hr.club).  

Qu茅 es el Club? Es una comunidad de aprendizaje de programaci贸n en R destinada para las personas que trabajan en Recursos Humanos de habla hispana.

Nosotras, [Yanel Paulette](https://www.linkedin.com/in/yanelpaulette/) y [Daniela Garcia ](https://www.linkedin.com/in/claudiadanielagarcia/) pertenecemos al club. 

-------------------------


\newpage

<img src="https://media.giphy.com/media/l0IyjiXOXTX6Yemsg/giphy.gif" />

---
### Objetivo

Vamos a analizar un texto, a trav茅s de un paquete de R llamado *Text Mining*.

En RRHH analizar texto resulta fundamental,  lo podriamos utilizar en entrevistas,  evaluaciones, encuestas, comunicaci贸n corporativa (...).  

*驴 Se te ocurre alg煤n otro uso? Contanos en comentarios. *

### Datos

Los datos que vamos a usar son de una canci贸n muy popular en Argentina.  (NO SE COMO AGREGAR ESPACIO)
驴Por qu茅 una canci贸n?  
La idea es demostrar  los resultados del uso de dicha herramienta y que sea visible para el lector.

La pieza musical en cuesti贸n es **"El B贸mbon"**, cuyos autores son **"Los Palmeras"**.[^1] 

[^1]: No es nuestro objetivo entrar en debate respecto del significado de la letra, su interpretaci贸n, ni tampoco realizar una critica artistica. Solo queremos usar los datos, y que sean facilmente visibles al lector.



```{r }
library(googlesheets4)
library(tidyverse)
library(gargle)
library(tidytext)
library(wordcloud2)
library(tm)
library(funModeling)
library(scales)
library(xaringan)
# Estilos para los gr谩ficos
zy <- theme(panel.background = element_blank(),
            panel.grid.major.y = element_line(colour = "#F4F6F6"),
            axis.line = element_line(colour = "grey"))

zx <- theme(panel.background = element_blank(),
            panel.grid.major.x = element_line(colour = "#F4F6F6"),
            axis.line = element_line(colour = "grey"))

letraPalmeras <- sheets_read("1FuU9kcPxJA37PGomv5zZzFrzchibEe-WDJ36Ty9vhHg")


```
Para trabajar con la letra, realizamos una serie de procesos, los cuales nos permiten acceder a una base de datos,  compuesta por los siguientes datos:

```{r include=FALSE}
dim(letraPalmeras)
head(letraPalmeras)
```

Tenemos un  archivo  inicial para trabajar compuesto por   `r ncol(letraPalmeras)` columna y `r nrow(letraPalmeras)` filas.  

```{r include=FALSE}
letraPalmeras<-letraPalmeras %>% 
  unnest_tokens(palabra, Comentarios)

dim(letraPalmeras)

letraPalmeras
```

Como sabemos,  hay palabras que encontramos en los discursos que no sirven para un an谩lisis, por ejemplo *"y"*, *"o"*, *"lo"*... 
Todas estas palabras las eliminamos de nuestras bases. 

```{r include=FALSE}
vacias <- read_csv("https://raw.githubusercontent.com/7PartidasDigital/AnaText/master/datos/diccionarios/vacias.txt",
                   locale = default_locale())

```

```{r}

letraPalmeras_vacio <- letraPalmeras %>%
  anti_join(vacias)

```


### Visualizar la Frecuencia de las Palabras

Nos interesa ver la frecuencia en la que aparecen las palabras en la canci贸n.

Lo podemos visualizar en el siguiente grafico: (NO SALE EL GRAFICO GRR)


```{r sent, message=FALSE, warning=FALSE, fig.show='hide'}

letraPalmeras_vacio %>% 
  count(palabra, sorte=TRUE)


letraPalmeras_vacio %>%
  count(palabra, sort = TRUE) %>%
  filter(n>1) %>%
  ggplot(aes(x= reorder(palabra, n), y = n, fill = n))+
  geom_bar(stat = 'identity') + 
  scale_fill_gradient(low = "#D6DBDF", high = "#34495E")+
  zx+
  labs(title= "El Bomb贸n",
       subtitle = "Autor: Los Palmeras",
       x="", y="Cantidad de apariciones") +
  coord_flip()


```

```{r ref.label="freq", echo=FALSE, message=FALSE, warning=FALSE}
```

### An谩lisis de Sentimientos

Ahora quisieramos saber la relaci贸n que hay entre las palabras de la canci贸n y los sentimientos. 

Por ejemplo: Si en una encuesta de clima tenemos palabras o frases  como *"Conforme"*, *"Recomendar铆a"*, *"Me encanta"*, podemos relacionarlo con un sentimiento **Positivo**. 
En cambio si aparece  *"Injusto"*, *"Desagradable"*, *"Angustia"*, podemos relacionarlo con uno **Negativo**. 

En el an谩lisis de sentimientos, hacemos el mismo procedimiento pero con un n煤mero mayor de categor铆as, como vemos a continuaci贸n. 

```{r}
sentimientos <- read_tsv("https://raw.githubusercontent.com/7PartidasDigital/AnaText/master/datos/diccionarios/sentimientos_2.txt",
                         col_types = "cccn",
                         locale = default_locale())



```

```{r}
source("https://raw.githubusercontent.com/7PartidasDigital/R-LINHD-18/master/get_sentiments.R")

```


```{r}

library(textdata)

letraPalmeras_nrc <- letraPalmeras_vacio %>%
  right_join(get_sentiments("nrc")) %>%
  filter(!is.na(sentimiento)) %>%
  count(sentimiento, sort = TRUE)
```

Podemos observar los sentimientos presentados. 
Hay una predominancia de sentimientos negativos en comparaci贸n de los positivos. 

Los sentimientos de alegria `r letraPalmeras$alegr铆a`  representan un % respecto a los de `r letraPalmeras$miedo`.   (VER para que salga esto)

```{r}
library(gt)
gt(letraPalmeras_nrc)

```


```{r}
feelings <- c("negativo", "positivo", "negativo", "negativo", "negativo", "positivo", "positivo", "positivo")


```
La representacion grafica seria la siguiente:


```{r}
letraPalmeras_nrc %>%
  filter(sentimiento != "negativo", sentimiento !="positivo") %>%
  cbind(feelings) %>% #el vector creado
  ggplot(aes(reorder(sentimiento, n), n, fill = feelings)) +
  geom_bar(stat = "identity", show.legend = FALSE) +
  scale_fill_manual(values = c("#F5B041","#5DADE2"))+
  zx + #Estilo grafico
  coord_flip() +
  labs(title="Ranking de sentimientos",
       x = "Sentimiento",
       y = "Cantidad de Apariciones")
```

Una de las cosas que se puede presentar en el an谩lisis, es que un sentimiento tenga una predominancia mayor o menor  que otra.  

驴Para qu茅 podria servirnos?

Para tenerlo en consideracion en el armado  de nuestras piezas de comunicacion  y usar esta informacion para reforzar conceptos, o suspender/eliminar aquellos que no estan ayudando. 

A continuaci贸n , podemos observar las palabras relacionadas con *"Confianza"*. 

```{r}
letraPalmeras_vacio %>%
  right_join(get_sentiments("nrc")) %>%
  filter(!is.na(sentimiento)) %>%
  group_by(sentimiento) %>%
  count(palabra, sort = TRUE) %>%
  filter(sentimiento == "confianza") %>% top_n(5)# solo podemos consultar los primeros 5


```
Asimismo podemos observar la frecuencia en las palabras relacionadas con la palabra  *"Miedo"*.

```{r}
letraPalmeras_vacio %>%
  right_join(get_sentiments("nrc")) %>%
  filter(!is.na(sentimiento)) %>%
  group_by(sentimiento) %>%
  count(palabra, sort = TRUE) %>%
  filter(sentimiento == "miedo") 
```


En conclusi贸n, el an谩lisis de las palabras por si solo, no nos dice nada, si no lo relacionamos con una accion concreta.  
Pero, como ustedes saben,  esta es la base del an谩lisis de datos. 

-------------------------

### Nube de Palabras

Por 煤ltimo,  con la presente pieza musical  podemos armar  una nube de palabras.

驴Para qu茅 usar una nube? ~~Porque queda divino~~
M谩s all谩 de lo est茅tico, las nubes de palabras nos sirven visualmente para observar aquellas palabras/categor铆as con mayor/menor presencia en el discurso analizado.  


Por ejemplo:  La empresa quiere cambiar su politica de beneficios. 
Para ello hace una consulta a su gente sobre qu茅 beneficios valorar铆an m谩s.
Y luego  utiliza la nube de palabras para demostrar que la empresa accedi贸 a otorgar aquellos beneficios con mayor cantidad de votos.  



_驴 Se te ocurren otros casos de uso? Contanos en comentarios._

Volviendo a nuestra canci贸n,  podemos observar que *"Bomb贸n"* es la que m谩s veces aparece. En menor medida, pero con una frecuencia alta aparece  *"Menea"* y *"Sabe"* y *"Mueve"*.

```{r}
letraPalmeras_vacio %>% 
  count(palabra,sort = TRUE) %>% 
  ungroup() %>% 
  wordcloud2(size = 0.6, shape = "cardioid")
```


Llegamos al final. Gracias por estar ahi.

Sabemos que la pr贸xima vez que escuchen el tema, recordar谩n esta lectura. 



[Yanel](https://www.linkedin.com/in/yanelpaulette/) y [Dani](https://www.linkedin.com/in/claudiadanielagarcia/) 


#### Fuentes

[Club de R para RRHH](https://data-4hr.com/2020/04/29/club-de-r/) Club de R

[Cuentapalabras](http://www.aic.uva.es/cuentapalabras/) 7 Partidas Digital

[Text Mining with R](https://www.tidytextmining.com/) de Julia Silge and David Robinson

[Wordcloud2](https://cran.r-project.org/web/packages/wordcloud2/vignettes/wordcloud.html)


